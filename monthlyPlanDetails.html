<!doctype html>
<html>
<head>
<meta http-equiv="Content-type" content="text/html;charset=utf-8" >
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,initial-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta name="format-detection" content="email=no">
<link rel="stylesheet" type="text/css" href="style/comm.css" />
<link rel="stylesheet" type="text/css" href="style/monthlyPlan.css" />
<script type="text/javascript" src="./js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="./js/vue.js"></script>
<title>月工作计划</title>
</head>
<body >
<div id="monthly">
    <header class="comm-header">
    	<div class="div"><h1><a href="javascript:history.back();" class="back"><i></i></a>月工作计划<a v-if="flg" :href="'monthlyPlanEdit.html?id='+data.id" class="comm-edit"></a></h1></div>
    </header> 
    <section>
    	
    	<ul class="deatails  pdlr1 bg_FFF">
        	<li>
            	<label>月报主人</label>
                <span>{{data.user_name}}</span>
            </li>
    		<li>
            	<a :href="'monthlyPlanLine.html?branch='+data.branch_id+'&id='+data.id+'&time='+data.create_time">
                    <label>所需部门</label>
                    <span>{{data.branch_name}}</span>
                    <span class="yan"></span>
                </a>
            </li>
        </ul>
        <div class="pdtb_5">
        <ul class="clearfix number_ul bg_FFF">
        	<li class=" w_50 border-right"><label>计划洽谈量</label><em  class="f_c ">{{data.planned_volume}}</em></li>
            <li class="w_50"><label>实际洽谈量</label><em class="f_c ">{{data.actual_volume}}</em></li>
            <li><label>本月完成</label>
            	<div class="bar"><div class="bar_progress" :style="'width:'+parseInt(data.actual_volume/data.planned_volume*100)>100?100:parseInt(data.actual_volume/data.planned_volume*100)+'%;'"></div></div>
                <i class="bar_number">{{parseInt(data.actual_volume/data.planned_volume*100)}}%</i>
            </li>
        </ul>
        </div>
        
        <div class="pdtb_5">
        <ul class="clearfix number_ul bg_FFF blue_color">
        	<li class=" w_50 "><label>计划签约量</label><em  class="f_c ">{{data.planned_quantity}}</em></li>
            <li class="w_50 "></li>
        	<li class=" w_50 border-right">
            	<label>计划洽谈量</label><em  class="f_c ">{{data.actual_quantity}}</em>
            </li>
            <li class="w_50 pdl_1">
            	<i class="fl w_25 ">直营</i>
                <em class="fl w_25 f_c">{{data.not_channel}}</em>
                <i class="fl w_25 f_c">渠道</i>
                <em class="fl w_25 f_r">{{data.channel}}</em>
            </li>
            <li><label>本月完成</label>
            	<div class="bar"><div class="bar_progress" :style="'width:'+parseInt(data.actual_quantity/data.planned_quantity*100)>100?100:parseInt(data.actual_quantity/data.planned_quantity*100)+'%;'"></div></div>
                <i class="bar_number">{{parseInt(data.actual_quantity/data.planned_quantity*100)}}%</i>
            </li>
        </ul>
        </div>
        
        <ul class="deatails  pdlr1 border_top bg_FFF">
        	<li>
            	<label>月报编号</label>
                <span>{{data.monthly_id}}</span>
            </li>
        	
            
            <li>
            	<label>添加时间</label>
                <span>{{formTime(data.create_time+"000")}}</span>
            </li>
            <li>
            	<label>备注</label>
                <p class="bj">{{data.remark}}</p>
            </li>
        </ul>
        
    </section>
</div>
    <script type="text/javascript" src="./js/comm.js"></script>
    <script type="text/javascript">
		$(function(){
            var id=GetQueryString("id"),
                user;
			new Vue({
                data:{
                    data:[],
                    flg:false
                },
                beforeCreate(){
                    user=sessionStorage.getItem("user");
                    if(!user){
                        window.location.href="login.html";
                    }else{
                        user=JSON.parse(user);
                        loading();
                    }
                    if(!id){
                        AlertFn({"cont":"数据有问题，请从新进入。",fn:function(){
                                window.location.href="monthlyPlan.html";
                            }
                        });
                    }
                },mounted(){
                    var _this=this;
                    ajaxComm({
                        url:"monthlyPlan.php",
                        params:{id:id,type:"select"},
                        success(data){
                            loadingRemove();
                            _this.$data.data=data;
                            _this.$data.flg=user.id==data.user_id;
                        }

                    })
                },methods:{
                    formTime(a){
                      var d=new Date();
                              d.setTime(a);
                              return d.getFullYear()+'-'+(d.getMonth()+1>9?(d.getMonth()+1):('0'+(d.getMonth()+1)))+'-'+(d.getDate()>9?d.getDate():('0'+d.getDate()));
                    }

                }
            }).$mount("#monthly");
		});
	</script>
</body>
</html>

